openapi: 3.0.3
info:
  description: |-
    This is an OpenAPI Specification for https://github.com/calvinmclean/automated-garden/tree/main/garden-app

    It allows managing and interacting with Gardens and Plants for this application.

  title: Garden App - OpenAPI
  version: 1.0.0
tags:
  - name: gardens
    description: Operations related to Garden resources
  - name: plants
    description: Operations related to Plant resources
paths:
  /gardens:
    post:
      tags:
        - gardens
      summary: Create a new Garden
      description: Create a new Garden
      operationId: createGarden
      responses:
        "200":
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GardenResponse"
        "400":
          description: Bad Request
      requestBody:
        description: Create a new Garden
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GardenRequest"
    get:
      tags:
        - gardens
      summary: Get all Gardens
      description: Get all Gardens
      operationId: getAllGardens
      responses:
        "200":
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AllGardensResponse"
        "400":
          description: Bad Request
      parameters:
        - name: end_dated
          in: query
          description: whether or not to include end-dated Gardens in the response
          required: false
          schema:
            type: boolean

components:
  schemas:
    xid:
      type: string
      description: 20 character unique identifier used throughout this API
      externalDocs:
        url: https://github.com/rs/xid
      pattern: "[0-9a-v]{20}"
      example: 9m4e2mr0ui3e8a215n4g

    link:
      type: object
      description: used for JSON Hypermedia
      properties:
        ref:
          type: string
          description: one-word explanation of what this link is for
        href:
          type: string
          description: relative path for the specified resource

    GardenRequest:
      type: object
      description: This allows creating or updating a Garden resource
      allOf:
        - $ref: "#/components/schemas/Garden"

    GardenResponse:
      type: object
      description: This is the response object for Gardens that contains extra information only available on Gardens that are created
      allOf:
        - $ref: "#/components/schemas/Garden"
        - properties:
            id:
              $ref: "#/components/schemas/xid"
            created_at:
              type: string
              format: date-time
              description: the date-time when the Garden was originally created
            next_light_action:
              type: object
              description: time and state for the next scheduled LightAction
              properties:
                time:
                  type: string
                  format: date-time
                  description: date-time of the next action
                state:
                  type: string
                  enum: [ON, OFF]
                  description: state that will be set by the next action
            plants:
              description: link specifically for the collection of Plants
              allOf:
                - $ref: "#/components/schemas/link"
              example:
                rel: collection
                href: /gardens/c6corm5mk1u53v1dchq0/plants
            links:
              type: array
              items:
                $ref: "#/components/schemas/link"
              example:
                - rel: self
                  href: /gardens/c6corm5mk1u53v1dchq0
                - rel: health
                  href: /gardens/c6corm5mk1u53v1dchq0/health
                - rel: plants
                  href: /gardens/c6corm5mk1u53v1dchq0/plants
                - rel: action
                  href: /gardens/c6corm5mk1u53v1dchq0/action
      required:
        - id
        - created_at
        - plants
        - links

    AllGardensResponse:
      type: object
      description: List of all Gardens
      properties:
        gardens:
          type: array
          items:
            $ref: "#/components/schemas/GardenResponse"

    Garden:
      type: object
      description: A Garden corresponds to a `garden-controller` in the real-world and contains all the necessary information for interacting with it
      properties:
        name:
          type: string
          description: |
            A descriptive name for the Garden. This is used as the prefix of the MQTT topic for sending messages to the controller, so it is recommended to avoid spaces and the following characters are not allowed: `[$#*>+/]`
          example: garden
        end_date:
          type: string
          format: date-time
          description: the date-time when the Garden was deleted/removed
        light_schedule:
          type: object
          description: describes when to turn on a light and for how long to leave it on
          properties:
            duration:
              type: string
              format: duration
              description: duration string to determine how long to leave a light on
              example: 14h
            start_time:
              type: string
              format: time
              description: time that the light should be turned on
              example: 23:00:00-07:00
          required:
            - duration
            - start_time
      required:
        - name
