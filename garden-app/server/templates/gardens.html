{{ define "innerHTML" }}
<div uk-grid>
    {{ range .Items }}
    {{ template "GardenCard" . }}
    {{ end }}
</div>
{{ end }}

{{ define "GardenCard" }}
<div class="uk-text-center uk-width-1-2@m">
    <div class="uk-card uk-card-default" style="margin: 5%;">
        <div class="uk-card-header">
            <h3 class="uk-card-title uk-margin-remove-bottom" href="/gardens/{{ .ID }}">
                <a href="/gardens/{{ .ID }}">{{ .Name }}</a>
                {{ if not .EndDated }}
                {{ template "healthBadge" . }}
                {{ end }}
            </h3>
        </div>
        <div class="uk-card-body">
            <span class="uk-label">
                {{ .NumZones }} Zones <i class="bi-grid"></i>
            </span>

            {{ if .LightSchedule }}
            {{ template "lightScheduleDetails" . }}
            {{ end }}
        </div>
        <div class="uk-card-footer">
            {{ template "actionButton" . }}
            {{ template "gardenInfoPopover" . }}
        </div>
    </div>
</div>
{{ end }}

{{ define "lightScheduleDetails" }}
<div style="text-decoration: none; color: inherit;">
    <div>
        Light will turn {{ .NextLightAction.State }} at {{ .NextLightAction.Time }}
        {{ if eq .NextLightAction.State.String "ON" }}
        <span uk-icon="icon: chevron-up" style="color: orange;"></span>
        {{ else }}
        <span uk-icon="icon: chevron-down" style="color: gray;"></span>
        {{ end }}
    </div>

    <div>Duration: {{ .LightSchedule.Duration }} <span uk-icon="icon: future"></span></div>
    <div>Starting At: {{ .LightSchedule.StartTime }} <span uk-icon="icon: clock"></span></div>
</div>
{{ end }}

{{ define "actionButton" }}
<div class="uk-inline">
    <button class="uk-button uk-button-default" type="button">Actions</button>
    <div uk-dropdown>
        <ul class="uk-nav uk-dropdown-nav">
            {{ if .LightSchedule }}
            <li>
                {{ template "lightActionButton" (args "ID" .ID.String "State" "ON") }}
            </li>
            <li>
                {{ template "lightActionButton" (args "ID" .ID.String "State" "OFF") }}
            </li>
            {{ end }}
            <li>
                <a hx-post="/gardens/{{ .ID }}/action" hx-ext='json-enc' hx-include="this">
                    <input type="hidden" name="stop" value="true">
                    <span uk-icon="icon: ban"></span> Stop Watering
                </a>
            </li>
        </ul>
    </div>
</div>
{{ end }}

{{ define "lightActionButton" }}
<a hx-post="/gardens/{{ .ID }}/action" hx-ext='json-enc' hx-include="this">
    <input type="hidden" name="light_state" value="{{ .State }}">
    {{ if eq .State "ON" }}
    <span uk-icon="icon: upload"></span>
    {{ else }}
    <span uk-icon="icon: download"></span>
    {{ end }}
    Light {{ .State }}
</a>
{{ end }}

{{ define "gardenInfoPopover" }}
<div class="uk-inline">
    <span class="uk-margin-small-right" uk-icon="info"></span>
    <div uk-dropdown>
        <p><b>{{ .ID }}</b></p>
        <p>Topic prefix: {{ .TopicPrefix }}</p>
    </div>
</div>
{{ end }}

{{ define "healthBadge" }}
{{ $labelColor := "warning" }}
{{ $icon := "close" }}
{{ if eq .Health.Status "UP" }}
{{ $labelColor = "success" }}
{{ $icon = "rss" }}
{{ else if eq .Health.Status "DOWN" }}
{{ $labelColor = "danger" }}
{{ end }}

<div class="uk-inline">
    <span class="uk-label uk-label-{{ $labelColor }}">
        <span uk-icon=" icon: {{ $icon }}"></span>
        {{ .Health.Status }}
    </span>
    <div uk-dropdown="pos: right-center">
        <p>{{ .Health.Details }}</p>
    </div>
</div>
{{ end }}