{{ define "innerHTML" }}
<div uk-grid>
    {{ range .Items }}
    {{ template "GardenCard" . }}
    {{ end }}
</div>
{{ end }}

{{ define "GardenCard" }}
<div class="uk-width-1-2@m">
    <div class="uk-card uk-card-default" style="margin: 5%;">
        <div class="uk-card-header uk-text-center">
            <h3 class="uk-card-title uk-margin-remove-bottom">
                <a href="/gardens/{{ .ID }}/zones">{{ .Name }}</a>
            </h3>
        </div>
        <div class="uk-card-body">
            {{ if not .EndDated }}
            {{ template "healthBadge" . }}
            {{ end }}

            <span class="uk-label">
                {{ .NumZones }} Zones <i class="bi-grid"></i>
            </span>

            {{ if .LightSchedule }}
            {{ template "lightScheduleDetails" . }}
            {{ end }}
        </div>
        <div class="uk-card-footer">
            <div class="uk-child-width-1-2" uk-grid>
                <div class=" uk-text-left">
                    {{ template "actionButton" . }}
                </div>
                <div class="uk-text-right">
                    {{ template "gardenInfoPopover" . }}
                </div>
            </div>
        </div>
    </div>
</div>
{{ end }}

{{ define "lightScheduleDetails" }}
<p>
    {{ $textColor := "uk-text-muted" }}
    {{ if eq .NextLightAction.State.String "ON" }}
    <span uk-icon="chevron-up" uk-tooltip="Turning On"></span>
    {{ $textColor = "uk-text-warning" }}
    {{ else }}
    <span uk-icon="chevron-down" uk-tooltip="Turning Off"></span>
    {{ end }}
    Light will turn <span class="{{ $textColor }}">{{ .NextLightAction.State }}</span> {{ FormatUpcomingDate
    .NextLightAction.Time }}
</p>

<p><span uk-icon="future" uk-tooltip="Duration"></span> {{ .LightSchedule.Duration }}</p>
<p><span uk-icon="clock" uk-tooltip="Start Time"></span> {{ .LightSchedule.StartTime }}</p>
{{ end }}

{{ define "actionButton" }}
<div class="uk-inline">
    <button class="uk-button uk-button-default" type="button">Actions</button>
    <div uk-dropdown>
        <ul class="uk-nav uk-dropdown-nav">
            {{ if .LightSchedule }}
            <li>
                {{ template "lightActionButton" (args "ID" .ID.String "State" "ON") }}
            </li>
            <li>
                {{ template "lightActionButton" (args "ID" .ID.String "State" "OFF") }}
            </li>
            {{ end }}
            <li>
                <a hx-post="/gardens/{{ .ID }}/action" hx-ext='json-enc' hx-include="this" hx-swap="none">
                    <input type="hidden" name="stop_all" value="true">
                    <span uk-icon="ban"></span> Stop Watering
                </a>
            </li>
        </ul>
    </div>
</div>
{{ end }}

{{ define "lightActionButton" }}
<!-- TODO: use HTMX to have some sort of feedback on button select, like change color -->
<a hx-post="/gardens/{{ .ID }}/action" hx-ext='json-enc' hx-include="this" hx-swap="none">
    <input type="hidden" name="light_state" value="{{ .State }}">
    {{ if eq .State "ON" }}
    <span uk-icon="upload"></span>
    {{ else }}
    <span uk-icon="download"></span>
    {{ end }}
    Light {{ .State }}
</a>
{{ end }}

{{ define "gardenInfoPopover" }}
<div class="uk-inline">
    <span class="uk-margin-small-right" uk-icon="info"></span>
    <div uk-dropdown>
        <p><b>{{ .ID }}</b></p>
        <p>Topic prefix: {{ .TopicPrefix }}</p>
    </div>
</div>
{{ end }}

{{ define "healthBadge" }}
{{ $labelColor := "warning" }}
{{ $icon := "close" }}
{{ if eq .Health.Status "UP" }}
{{ $labelColor = "success" }}
{{ $icon = "rss" }}
{{ else if eq .Health.Status "DOWN" }}
{{ $labelColor = "danger" }}
{{ end }}
<span class="uk-label uk-label-{{ $labelColor }}">
    <span uk-icon=" {{ $icon }}"></span>
    {{ .Health.Status }}
</span>
<div uk-dropdown="pos: right-center">
    <p>{{ .Health.Details }}</p>
</div>
{{ end }}